import{r as n,j as t}from"./index-DqF_UOxf.js";import{a as G,u as I,c as B,b as P}from"./useTranslate-BFk4fjx0.js";import{S as T,T as k,a as U}from"./StatCard-_ssqVE45.js";import{u as $,d as R}from"./customCategories.store-BtWWAw-Z.js";import{B as q}from"./Button-B9GeY9d5.js";import"./dateFormatter-DXrkKmr8.js";import"./clsx-B-dksMZM.js";async function D(l){const d=await fetch("https://fin-mon-back-e15f6414d5e5.herokuapp.com/api/advice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!d.ok){const m=await d.json();throw new Error(m.error||"Request failed")}return(await d.json()).advice}const W=()=>{const[l,f]=n.useState("all"),[d,b]=n.useState("overview"),[m,A]=n.useState(""),[v,h]=n.useState(""),[y,p]=n.useState(null),[j,N]=n.useState(!1),u=G(e=>e.selectedCurrency),c=I(e=>e.transactions),C=$(e=>e.categories),E=B(e=>e.lang),s=P(),S=n.useMemo(()=>[...R,...C],[C]),L=n.useMemo(()=>[{value:"overview",label:s("transactions.gpt.typeOverview")},{value:"savings",label:s("transactions.gpt.typeSavings")},{value:"cuts",label:s("transactions.gpt.typeCuts")},{value:"budget",label:s("transactions.gpt.typeBudget")}],[s]),{filteredTransactions:w,totalIncome:g,totalExpense:x}=n.useMemo(()=>{const e=c.filter(a=>a.type>0).reduce((a,i)=>a+i.amount*i.type,0),r=c.filter(a=>a.type<0).reduce((a,i)=>a+Math.abs(i.amount*i.type),0);return{filteredTransactions:c.filter(a=>l==="income"?a.type>0:l==="expense"?a.type<0:!0),totalIncome:e,totalExpense:r}},[c,l]),M=n.useMemo(()=>{const e=r=>{const o=S.find(F=>F.id===r);if(!o)return s("transactionCard.noCategory");const a=`categories.${o.category}`,i=s(a);return i===a?o.category:i};return c.map(r=>{const o=new Date(r.date);return{date:Number.isNaN(o.getTime())?"":o.toISOString().slice(0,10),type:r.type>0?"income":"expense",amount:Math.abs(r.amount*r.type),currency:u,category:e(r.id_category),description:r.description??""}}).sort((r,o)=>o.date.localeCompare(r.date)).slice(0,80)},[c,S,s,u]),O=async()=>{if(p(null),h(""),!m.trim()){p(s("transactions.gpt.emptyError"));return}if(c.length===0){p(s("transactions.gpt.noTransactions"));return}N(!0);try{const e=await D({focus:d,goal:m.trim(),currency:u,language:E,totals:{income:g,expense:x,net:g-x},transactions:M});h(e)}catch{p(s("transactions.gpt.error"))}finally{N(!1)}};return t.jsxs("div",{className:"min-h-screen bg-background text-primary p-6 pb-8 transition-colors duration-300",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold mb-6",children:s("titles.transactionsPage")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsx(T,{label:s("common.income"),amount:g,currency:u,type:"income",icon:k}),t.jsx(T,{label:s("common.expenses"),amount:x,currency:u,type:"expense",icon:k})]}),t.jsxs("div",{className:"mb-8 rounded-2xl border border-muted bg-secondary/40 p-4",children:[t.jsx("div",{className:"flex items-center justify-between gap-3",children:t.jsx("h3",{className:"text-lg font-semibold",children:s("transactions.gpt.title")})}),t.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-[220px,1fr,auto]",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-sm text-muted-foreground",children:s("transactions.gpt.typeLabel")}),t.jsx("select",{className:"rounded-lg border border-muted bg-background px-3 py-2 text-sm text-primary",value:d,onChange:e=>b(e.target.value),children:L.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-sm text-muted-foreground",children:s("transactions.gpt.goalLabel")}),t.jsx("textarea",{rows:2,value:m,onChange:e=>A(e.target.value),placeholder:s("transactions.gpt.goalPlaceholder"),className:"min-h-11 rounded-lg border border-muted bg-background px-3 py-2 text-sm text-primary"})]}),t.jsx("div",{className:"flex items-end",children:t.jsx(q,{onClick:O,loading:j,children:s(j?"transactions.gpt.loading":"transactions.gpt.cta")})})]}),y&&t.jsx("p",{className:"mt-3 text-sm text-red-600",children:y}),v&&t.jsxs("div",{className:"mt-4 rounded-xl border border-muted bg-background/70 p-4",children:[t.jsx("p",{className:"text-sm font-semibold mb-2",children:s("transactions.gpt.resultTitle")}),t.jsx("div",{className:"whitespace-pre-line text-sm text-primary",children:v})]})]}),t.jsx("div",{className:"flex gap-2 p-1 bg-secondary/50 rounded-xl w-fit border border-muted",children:["all","income","expense"].map(e=>t.jsx("button",{onClick:()=>f(e),className:`px-6 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${l===e?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:text-primary"}`,children:s(e==="all"?"transactions.filters.all":e==="income"?"transactions.filters.income":"transactions.filters.expense")},e))})]}),t.jsx("div",{className:"space-y-4",children:w.length>0?w.map(e=>t.jsx(U,{transaction:e},e.id)):t.jsx("div",{className:"text-center py-12 text-muted-foreground",children:s("transactions.empty")})})]})};export{W as default};
